<!doctype html>
<html lang="es">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_highlighter.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>4.16.4. Paquetes | UA4b. PL/SQL </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta name="author" content="David Bermúdez" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/4.0/" />
<meta name="generator" content="eXeLearning 2.7 - exelearning.net" />
<!--[if lt IE 9]><script type="text/javascript" src="exe_html5.js"></script><![endif]-->
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_highlighter.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<link rel="stylesheet" type="text/css" href="udl-content.css" />
<script type="text/javascript" src="udl-content.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
	</head>
<body class="exe-web-site" id="exe-node-15"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<header id="header" ><div id="headerContent">UA4b. PL/SQL</div></header>
<nav id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UA04. PL/SQL</a></li>
   <li><a href="410_conceptos_bsicos.html" class="no-ch">4.10. Conceptos básicos</a></li>
   <li><a href="411_tipos_de_datos_simples_variables_y_constantes.html" class="no-ch">4.11. Tipos de datos simples, variables y constantes</a></li>
   <li><a href="412_variables_y_constantes.html" class="no-ch">4.12. Variables y constantes</a></li>
   <li><a href="413_el_bloque_plsql.html" class="daddy">4.13. El bloque PL/SQL</a>
   <ul class="other-section">
      <li><a href="4131_estructuras_de_control.html" class="no-ch">4.13.1. Estructuras de control</a></li>
   </ul>
   </li>
   <li><a href="414_excepciones.html" class="daddy">4.14. Excepciones</a>
   <ul class="other-section">
      <li><a href="4141_excepciones_ii.html" class="no-ch">4.14.1. Excepciones II</a></li>
      <li><a href="4142_excepciones_iii.html" class="no-ch">4.14.2. Excepciones III</a></li>
      <li><a href="4143_excepciones_iv.html" class="no-ch">4.14.3. Excepciones IV</a></li>
   </ul>
   </li>
   <li><a href="415_cursores.html" class="no-ch">4.15. Cursores</a></li>
   <li class="current-page-parent"><a href="416_abstraccin.html" class="current-page-parent daddy">4.16. Abstracción</a>
   <ul>
      <li><a href="4161_subprogramas.html" class="no-ch">4.16.1. Subprogramas</a></li>
      <li><a href="4162_almacenar_subprogramas.html" class="no-ch">4.16.2. Almacenar subprogramas</a></li>
      <li><a href="4163_paso_de_parmetros.html" class="no-ch">4.16.3. Paso de parámetros</a></li>
      <li id="active"><a href="4164_paquetes.html" class="active no-ch">4.16.4. Paquetes</a></li>
   </ul>
   </li>
   <li><a href="417_disparadores.html" class="no-ch">4.17. Disparadores</a></li>
</ul>
</nav>
<div id='topPagination'>
<nav class="pagination noprt">
<a href="4163_paso_de_parmetros.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="417_disparadores.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
<div id="main-wrapper">
<section id="main">
<header id="nodeDecoration"><h1 id="nodeTitle">4.16.4. Paquetes</h1></header>
<article class="iDevice_wrapper UDLcontentIdevice" id="id22">
<div class="iDevice emphasis0" >
<div id="ta22_841_2" class="block iDevice_content">
<div class="exe-udlContent exe-udlContent-engagement"><section class="exe-udlContent-block"><div class="exe-udlContent-content"><div class="exe-udlContent-content-main"><p>Un paquete es un objeto que agrupa tipos, elementos y subprogramas. Suelen tener dos partes: la especificación y el cuerpo, aunque algunas veces el cuerpo no es necesario.</p>
<p>En la parte de especificación declararemos la interfaz del paquete con nuestra aplicación y en el cuerpo es donde implementaremos esa interfaz.</p>
<p>Para crear un paquete usaremos la siguiente sintaxis:</p>
<div class="highlighted-code language-sql">
<div>
<pre><code>CREATE [OR REPLACE] PACKAGE nombre AS
[declaraciones públicas y especificación de subprogramas]
END [nombre];

CREATE [OR REPLACE] PACKAGE BODY nombre AS
[declaraciones privadas y cuerpo de los subprogramas especificados]
[BEGIN
sentencias de inicialización]
END [nombre];</code></pre>
</div>
</div>
<p>La parte de inicialización sólo se ejecuta una vez, la primera vez que el paquete es referenciado.</p>
<p>Para referenciar las partes visibles de un paquete, lo haremos por medio de la notación del punto.</p>
<div class="highlighted-code language-sql">
<div>
<pre><code>BEGIN
...
call_center.borra_agente( 10 );
...
END;</code></pre>
</div>
</div>
</div></div></section></div>
</div>
</div>
</article>
<article class="iDevice_wrapper UDLcontentIdevice em_iDevice em_iDevice_diary" id="id23">
<div class="iDevice emphasis1" >
<header class="iDevice_header" style="background-image:url(icon_diary.png)"><h1 class="iDeviceTitle">Ejemplo</h1></header>
<div class="iDevice_inner">
<div class="iDevice_content_wrapper">
<div id="ta23_842_2" class="block iDevice_content">
<div class="exe-udlContent exe-udlContent-engagement"><section class="exe-udlContent-block"><div class="exe-udlContent-content"><div class="exe-udlContent-content-main"><div class="highlighted-code language-sql line-numbers">
<div>
<pre><code>CREATE OR REPLACE PACKAGE call_center AS     --inicialización 

     --Definimos los tipos que utilizaremos 
     SUBTYPE agente IS agentes%ROWTYPE; 
     SUBTYPE familia IS familias%ROWTYPE; 
     SUBTYPE oficina IS oficinas%ROWTYPE; 
     TYPE tAgentes IS TABLE OF agente; 
     TYPE tFamilias IS TABLE OF familia; 
     TYPE tOficinas IS TABLE OF oficina; 
     
     --Definimos las excepciones propias 
     referencia_no_encontrada exception; 
     referencia_encontrada exception; 
     no_null exception; 
     PRAGMA EXCEPTION_INIT(referencia_no_encontrada, -2291); 
     PRAGMA EXCEPTION_INIT(referencia_encontrada, -2292); 
     PRAGMA EXCEPTION_INIT(no_null, -1400); 
     
     --Definimos los errores que vamos a tratar 
     todo_bien                CONSTANT NUMBER := 0; 
     elemento_existente           CONSTANT NUMBER:= -1; 
     elemento_inexistente           CONSTANT NUMBER:= -2; 
     padre_existente          CONSTANT NUMBER:= -3; 
     padre_inexistente          CONSTANT NUMBER:= -4; 
     no_null_violado          CONSTANT NUMBER:= -5; 
     operacion_no_permitida          CONSTANT NUMBER:= -6; 
     
     --Definimos los subprogramas públicos 
     --Nos devuelve la oficina padre de un agente 
     PROCEDURE oficina_padre( mi_agente agente, padre OUT oficina ); 
     
     --Nos devuelve la oficina padre de una familia 
     PROCEDURE oficina_padre( mi_familia familia, padre OUT oficina ); 
     
     --Nos da los hijos de una familia 
     PROCEDURE dame_hijos( mi_familia familia, hijos IN OUT tAgentes ); 
     
     --Nos da los hijos de una oficina 
     PROCEDURE dame_hijos( mi_oficina oficina, hijos IN OUT tAgentes ); 
     
     --Inserta un agente 
     FUNCTION inserta_agente ( mi_agente agente ) 
     RETURN NUMBER; 
     
     --Inserta una familia 
     FUNCTION inserta_familia( mi_familia familia ) 
     RETURN NUMBER; 
     
     --Inserta una oficina 
     FUNCTION inserta_oficina ( mi_oficina oficina ) 
     RETURN NUMBER; 
     
     --Borramos una oficina 
     FUNCTION borra_oficina( id_oficina NUMBER ) 
     RETURN NUMBER; 
     
     --Borramos una familia 
     FUNCTION borra_familia( id_familia NUMBER ) 
     RETURN NUMBER; 
     
     --Borramos un agente 
     FUNCTION borra_agente( id_agente NUMBER ) 
     RETURN NUMBER; 
END call_center; 
/ 

CREATE OR REPLACE PACKAGE BODY call_center AS          --cuerpo 
     --Implemento las funciones definidas en la especificación 
     
     --Nos devuelve la oficina padre de un agente 
     PROCEDURE oficina_padre( mi_agente agente, padre OUT oficina ) IS 
          mi_familia familia; 
     BEGIN 
          IF (mi_agente.oficina IS NOT NULL) THEN 
               SELECT * INTO padre FROM oficinas 
               WHERE identificador = mi_agente.oficina; 
          ELSE 
               SELECT * INTO mi_familia FROM familias 
               WHERE identificador = mi_agente.familia; 
               oficina_padre( mi_familia, padre ); 
          END IF; 
     EXCEPTION 
          WHEN OTHERS THEN 
               padre := NULL; 
     END oficina_padre; 
     
     --Nos devuelve la oficina padre de una familia 
     PROCEDURE oficina_padre( mi_familia familia, padre OUT oficina ) IS 
          madre familia; 
     BEGIN 
          IF (mi_familia.oficina IS NOT NULL) THEN 
               SELECT * INTO padre FROM oficinas 
               WHERE identificador = mi_familia.oficina; 
          ELSE 
               SELECT * INTO madre FROM familias 
               WHERE identificador = mi_familia.familia; 
               oficina_padre( madre, padre ); 
          END IF; 
     EXCEPTION 
          WHEN OTHERS THEN 
               padre := NULL; 
     END oficina_padre; 
     
     --Nos da los hijos de una familia 
     PROCEDURE dame_hijos( mi_familia familia, hijos IN OUT tAgentes ) IS 
          CURSOR cHijos IS SELECT * FROM agentes 
          WHERE familia = mi_familia.identificador; 
          CURSOR cHijas IS SELECT * FROM familias 
          WHERE familia = mi_familia.identificador; 
          hijo agente; 
          hija familia; 
     BEGIN 
          --inicializamos la tabla si no lo está 
          if (hijos IS NULL) THEN 
               hijos := tAgentes(); 
          END IF; 
          --metemos en la tabla los hijos directos 
          OPEN cHijos; 
          LOOP 
               FETCH cHijos INTO hijo; 
               EXIT WHEN cHijos%NOTFOUND; 
               hijos.EXTEND; 
               hijos(hijos.LAST) := hijo; 
          END LOOP; 
          CLOSE cHijos; 
          --hacemos lo mismo para las familias hijas 
          OPEN cHijas; 
          LOOP 
               FETCH cHijas INTO hija; 
               EXIT WHEN cHijas%NOTFOUND; 
               dame_hijos( hija, hijos ); 
          END LOOP; 
          CLOSE cHijas; 
     EXCEPTION 
          WHEN OTHERS THEN 
               hijos := tAgentes(); 
     END dame_hijos; 
     
     --Nos da los hijos de una oficina 
     PROCEDURE dame_hijos( mi_oficina oficina, hijos IN OUT tAgentes ) IS 
          CURSOR cHijos IS SELECT * FROM agentes 
          WHERE oficina = mi_oficina.identificador; 
          CURSOR cHijas IS SELECT * FROM familias 
          WHERE oficina = mi_oficina.identificador; 
          hijo agente; 
          hija familia; 
     BEGIN 
          --inicializamos la tabla si no lo está 
          if (hijos IS NULL) THEN 
               hijos := tAgentes(); 
          END IF; 
          --metemos en la tabla los hijos directos 
          OPEN cHijos; 
          LOOP 
               FETCH cHijos INTO hijo; 
               EXIT WHEN cHijos%NOTFOUND; 
               hijos.EXTEND; 
               hijos(hijos.LAST) := hijo; 
          END LOOP; 
          CLOSE cHijos; 
          --hacemos lo mismo para las familias hijas 
          OPEN cHijas; 
          LOOP 
               FETCH cHijas INTO hija; 
               EXIT WHEN cHijas%NOTFOUND; 
               dame_hijos( hija, hijos ); 

         END LOOP; 
          CLOSE cHijas; 
     EXCEPTION 

         WHEN OTHERS THEN 
               hijos := tAgentes(); 
     END dame_hijos; 
     
     --Inserta un agente 
     FUNCTION inserta_agente ( mi_agente agente ) 
     RETURN NUMBER IS 
     BEGIN 
          IF (mi_agente.familia IS NULL and mi_agente.oficina IS NULL) THEN 
               RETURN operacion_no_permitida; 
          END IF; 
          IF (mi_agente.familia IS NOT NULL and mi_agente.oficina IS NOT NULL) THEN 
               RETURN operacion_no_permitida; 
          END IF; 
          INSERT INTO agentes VALUES (mi_agente.identificador, mi_agente.nombre, mi_agente.usuario, mi_agente.clave, mi_agente.habilidad, mi_agente.categoria, mi_agente.familia, mi_agente.oficina ); 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN referencia_no_encontrada THEN 
               ROLLBACK; 
               RETURN padre_inexistente; 
          WHEN no_null THEN 
               ROLLBACK; 
               RETURN no_null_violado; 
          WHEN DUP_VAL_ON_INDEX THEN 
               ROLLBACK; 
               RETURN elemento_existente; 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END inserta_agente; 
     
     --Inserta una familia 
     FUNCTION inserta_familia( mi_familia familia ) 
     RETURN NUMBER IS 
     BEGIN 
          IF (mi_familia.familia IS NULL and mi_familia.oficina IS NULL) THEN 
               RETURN operacion_no_permitida; 
          END IF; 
          IF (mi_familia.familia IS NOT NULL and mi_familia.oficina IS NOT NULL) THEN 
               RETURN operacion_no_permitida; 
          END IF; 
          INSERT INTO familias VALUES ( mi_familia.identificador, mi_familia.nombre, mi_familia.familia, mi_familia.oficina ); 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN referencia_no_encontrada THEN 
               ROLLBACK; 
               RETURN padre_inexistente; 
          WHEN no_null THEN 
               ROLLBACK; 
               RETURN no_null_violado; 
          WHEN DUP_VAL_ON_INDEX THEN 
               ROLLBACK; 
               RETURN elemento_existente; 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END inserta_familia; 

    
     --Inserta una oficina 
     FUNCTION inserta_oficina ( mi_oficina oficina ) 
     RETURN NUMBER IS 

     BEGIN 
          INSERT INTO oficinas VALUES (mi_oficina.identificador, mi_oficina.nombre, mi_oficina.domicilio, mi_oficina.localidad, mi_oficina.codigo_postal ); 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN no_null THEN 
               ROLLBACK; 
               RETURN no_null_violado; 
          WHEN DUP_VAL_ON_INDEX THEN 
               ROLLBACK; 
               RETURN elemento_existente; 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END inserta_oficina; 
     
     --Borramos una oficina 
     FUNCTION borra_oficina( id_oficina NUMBER ) 
     RETURN NUMBER IS 
          num_ofi NUMBER; 
     BEGIN 
          SELECT COUNT(*) INTO num_ofi FROM oficinas 
          WHERE identificador = id_oficina; 
          IF (num_ofi = 0) THEN 
               RETURN elemento_inexistente; 
          END IF; 
          DELETE oficinas WHERE identificador = id_oficina; 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END borra_oficina; 
     
     --Borramos una familia 
     FUNCTION borra_familia( id_familia NUMBER ) 
     RETURN NUMBER IS 
          num_fam NUMBER; 
     BEGIN 
          SELECT COUNT(*) INTO num_fam FROM familias 
          WHERE identificador = id_familia; 
          IF (num_fam = 0) THEN 
               RETURN elemento_inexistente; 
          END IF; 
          DELETE familias WHERE identificador = id_familia; 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END borra_familia; 
      
     --Borramos un agente 
     FUNCTION borra_agente( id_agente NUMBER ) 
     RETURN NUMBER IS 
          num_ag NUMBER; 
     BEGIN 
          SELECT COUNT(*) INTO num_ag FROM agentes 
          WHERE identificador = id_agente; 
          IF (num_ag = 0) THEN 
               RETURN elemento_inexistente; 
          END IF; 
          DELETE agentes WHERE identificador = id_agente; 
          COMMIT; 
          RETURN todo_bien; 
     EXCEPTION 
          WHEN OTHERS THEN 
               ROLLBACK; 
               RETURN SQLCODE; 
     END borra_agente; 
END call_center; 
/ </code></pre>
</div>
</div></div></div></section></div>
</div>
</div>
</div>
</div>
</article>
<div id="packageLicense" class="cc cc-by-sa">
<p><span>Obra publicada con</span> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Licencia Creative Commons Reconocimiento Compartir igual 4.0</a></p>
</div>
</section>
</div>
<div id='bottomPagination'>
<nav class="pagination noprt">
<a href="4163_paso_de_parmetros.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="417_disparadores.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</nav>
</div>
</div>
<script type="text/javascript" src="_cedec_js.js"></script></body></html>